<?xml version="1.0" encoding="UTF-8"?>
<!--Sample XML file generated by XML Spy v4.4 U (http://www.xmlspy.com)-->
<SPEAR-CONFIG xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="spear.xsd">
	<MODULE>
		<NAME>Off-Prop link table populator</NAME>
		<PROCESS-ID>TEST</PROCESS-ID>
		<DESCRIPTION>For Testing</DESCRIPTION>
		<CYCLE-DEPENDENCIES>
			<ASSERTER CLASS="com.cs.sg.spear.core.cycledependency.SystemGCForcer"/>
			<ASSERTER CLASS="com.cs.sg.spear.core.cycledependency.StatsCollector"/>
		</CYCLE-DEPENDENCIES>
		<MODULE-PARAM>
		   <PARAM NAME="spear.semaphore.check" VALUE="false"/>
		   <PARAM NAME="spear.cycle.interval" VALUE="5000"/>
		   <PARAM NAME="spear.shutdown" VALUE="Wed:21:58"/>
		   <PARAM NAME="spear.cycle.count" VALUE="1"/>
		   <PARAM NAME="spear.cache.pool.size" VALUE="10"/>
    	   <PARAM NAME="spear.watcher.enable" VALUE="false"/>
   		   <PARAM NAME="spear.watcher.interval" VALUE="2000"/>	
		   <PARAM NAME="var.abc" VALUE="@@abc@@"/>	
		</MODULE-PARAM>
	</MODULE>
	<DATA-EXTRACTOR NAME="driver">
			<PARAM NAME="data.provider" VALUE="getData"/>			
	</DATA-EXTRACTOR>
	<DATA-TRANSFORMER NAME="trans" TYPE="script" POOL-SIZE="10" THREAD-COUNT="1">
		<PARAM NAME="rejection.report.type" VALUE="file"/>
		<PARAM NAME="rejection.report.source" VALUE="C:/app/temp/pecs/report"/>
		<PARAM NAME="script.value"><![CDATA[
				try{
					System.out.println("inside transformer [driver.trans_alt_id]:"+_dataset.getDriverRow().getValue("trans_alt_id"));
					System.out.println("Lookup count:"+_dataset.getLookupResult("thLkp").getRowCount());
				}catch(Exception ex){
					throw ex;
				}

		]]></PARAM>
	</DATA-TRANSFORMER>

	<DATA-WRITERS ON-ERROR="failall" THREAD-COUNT="5">
		<WRITER NAME="linkTableWriter" >
			<PARAM NAME="query"><![CDATA[insert into MIGRATIONTESTLINK (FOID, PRODFOINTRLID,UATFOINTRLID,STAMP_ADD_DTIME) values (123, ?, ?, sysdate)]]></PARAM>
			<PARAM NAME="resource" VALUE="CSARUAT2"/>
			<PARAM NAME="key.name" VALUE="testLinkTable"/>
			<PARAM NAME="batch.size" VALUE="10"/>
			<PARAM NAME="batch.per.request" VALUE="true"/>
		</WRITER>
	</DATA-WRITERS>
	<RESOURCES>
		<RESOURCE NAME="CSARUAT2" TYPE="DB" LOAD-PRIORITY="2" UNLOAD-PRIORITY="1">
			<PARAM NAME="driver.classname" VALUE="oracle.jdbc.OracleDriver"/>
			<PARAM NAME="connection.url" VALUE="jdbc:oracle:thin:@sgs69h-0001z.sg.csfb.com:1521:QSGCSAR2"/>
			<PARAM NAME="user.name" VALUE="odsadm"/>
			<PARAM NAME="password" VALUE="changi2oo6"/>
			<PARAM NAME="pool.size" VALUE="10"/>
			<PARAM NAME="pool.on.start" VALUE="false"/>
			<PARAM NAME="max.wait" VALUE="5000"/>
			<PARAM NAME="default.autocommit" VALUE="true"/>
		</RESOURCE>
	</RESOURCES>
	<DATA-PROVIDERS>
		
		<DATA-PROVIDER NAME="thWrap" TYPE="PROC">
			<PARAM NAME="procedure"><![CDATA[
				RecordSet rs=null;
				try{
					rs = _datahandler.getData("trdheader");
				}
				catch(Exception ex){
					System.out.println(ex);
				}
				return rs;
			]]></PARAM>
			<PARAM NAME="cache.type" VALUE="incremental"/>
		</DATA-PROVIDER>
		
		<DATA-PROVIDER NAME="getData" TYPE="proc">
			<PARAM NAME="procedure"><![CDATA[
			RecordSet rs = null;
				try{
					if(${module@var.abc}==1){
						System.out.println("inside if");
						rs = _datahandler.getData("trans1");
					}
					else{
					System.out.println("inside else");
						RecordSetImpl_Disconnected rs1 = (RecordSetImpl_Disconnected) _datahandler.getData("trans1");
						System.out.println("rs1.count:"+rs1.getRowCount());
						RecordSetImpl_Disconnected rs2 = (RecordSetImpl_Disconnected) _datahandler.getData("trans2");
						System.out.println("rs2.count:"+rs2.getRowCount());
						rs1.addResult(rs2);
						rs= rs1;
					System.out.println("rs.count:"+rs.getRowCount());
					}
				}catch(DataException ex){
					throw ex;
				}
				return rs;
			 ]]></PARAM>
		</DATA-PROVIDER>	

		<DATA-PROVIDER NAME="trans1" TYPE="DB">
			<PARAM NAME="query"><![CDATA[select b.ODS_PROCESS_DATE ,a.* from ods_trans_alt_id a,ODS_TRANS b where a.trans_id=b.trans_id and b.ODS_PROCESS_DATE ='02-MAR-2009' and a.trans_alt_id like 'J:200903%' and rownum <50]]></PARAM>
			<PARAM NAME="resource" VALUE="CSARUAT2"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="trans2" TYPE="DB">
			<PARAM NAME="query"><![CDATA[select b.ODS_PROCESS_DATE ,a.* from ods_trans_alt_id a,ODS_TRANS b where a.trans_id=b.trans_id and b.ODS_PROCESS_DATE ='16-MAR-2009'and a.trans_alt_id like 'J:200903%' and rownum <50]]></PARAM>
			<PARAM NAME="resource" VALUE="CSARUAT2"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="trdheader" TYPE="DB">
			<PARAM NAME="query"><![CDATA[select * from ODS_TRADE_HEADER where rownum <10]]></PARAM>
			<PARAM NAME="resource" VALUE="CSARUAT2"/>
		</DATA-PROVIDER>

		
	</DATA-PROVIDERS>
	
	<DATA-LOOKUP>				
		<LOOKUP NAME="thLkp" DATA-PROVIDER="thWrap">
			<FILTER>ODS_ORDER_ID=24561732</FILTER>
		</LOOKUP>
	</DATA-LOOKUP>

	<EXCEPTION-HANDLER>
		<HANDLER CLASS="com.cs.sg.spear.core.exception.SpearExceptionHandler" NAME="default.exception.handler"/>
		
		<HANDLE EXCEPTION="com.cs.sg.spear.core.exception.ValidatorException" HANDLER="default.exception.handler">
			<ERROR CODE="ERROR_THRESHOLD_EXCEEDED"  VALUE="*" TYPE="fatal"/>
		</HANDLE>

		<HANDLE EXCEPTION="java.sql.SQL1Exception" HANDLER="default.exception.handler">
			<ERROR CODE="SQL_EXCEPTION"  VALUE="*" TYPE="fatal"/>
		</HANDLE>
		
		<HANDLE EXCEPTION="com.cs.sg.spear.core.exception.SpearRuntimeException" HANDLER="default.exception.handler">
			<ERROR CODE="LOOKUP_NOT_FOUND"  VALUE="*" TYPE="fatal"/>
		</HANDLE>		
	</EXCEPTION-HANDLER>
	
</SPEAR-CONFIG>
