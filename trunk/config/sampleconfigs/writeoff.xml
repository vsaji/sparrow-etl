<?xml version="1.0" encoding="UTF-8"?>
<!--Sample XML file generated by XML Spy v4.4 U (http://www.xmlspy.com)-->
<SPEAR-CONFIG xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="spear.xsd">
	<MODULE>
		<NAME>Off-Prop link table populator</NAME>
		<PROCESS-ID>TEST</PROCESS-ID>
		<DESCRIPTION>For Testing</DESCRIPTION>
		<CYCLE-DEPENDENCIES>
			<ASSERTER CLASS="com.cs.sg.spear.core.cycledependency.SystemGCForcer"/>
			<ASSERTER CLASS="com.cs.sg.spear.core.cycledependency.StatsCollector"/>
		</CYCLE-DEPENDENCIES>
		<MODULE-PARAM>
		   <PARAM NAME="spear.semaphore.check" VALUE="false"/>
		   <PARAM NAME="spear.cycle.interval" VALUE="5000"/>
		   <PARAM NAME="spear.shutdown" VALUE="Wed:21:58"/>
		   <PARAM NAME="spear.cycle.count" VALUE="1"/>
		   <PARAM NAME="spear.cache.pool.size" VALUE="10"/>
    	   <PARAM NAME="spear.watcher.enable" VALUE="false"/>
   		   <PARAM NAME="spear.watcher.interval" VALUE="2000"/>		   
		</MODULE-PARAM>
	</MODULE>
	<DATA-EXTRACTOR NAME="driver" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
						select distinct GLP_JRNL_LIN_REF,GLP_INV_ID  from INSPIRE.IN_GLP_GL_POST where 
						GLP_BUSINESS_PROCESS='IC'
						and GLP_JRNL_LIN_REF in (select CLM_POST_ID from inspire.IC_CLM_CLAIM where CLM_ID in 
						(84817,83412,81753,81694,133041,134572,136031,134490,135965,135968,134492,131763,134491,134696,135966,131768,
						135037,137777,80528,75218,75689,76470,74910,73255,75701,75144,78488,75239,79351,75693,79589,79311,80960,84451,
						159504,156873,159786,158576,158062,159600,159110,159675,159680,159777,159664,159681,89408,90126,88222,103745,
						105247,104500,105539,100267,105540,100268,105579,106254,100260,104846,100081,106253,104506,101759,105504,100019,
						87852,89322,87351,89106,89380,86535,86550,85636,90405,89715,85765,98347,94760,93399,93640,93918,94312,98369,94768,
						95982,94769,98558,120524,120519,120525,118185,115201,120750,111168,113912,109761,111996,112049,113107,108215,108217,
						107678,111250,107129,108557,113911,109763,72298,72293,151688,151913,153106,153107,150291,151954,153081,155131,
						154546,154591,156113,155730,148811,150107,148404,147121,148275,143167,138330,143002,143901,144232,121524,125705,
						121825,126801,119295,131305,79874,76736,76765,78801,80553,73232,79466,74872,77275,85317,82334,85284,90269,86277,
						92152,85600,91459,90267,88975,116185,119049,94584,94142,93169,94109,97028,98285,97987,96750,107333,109466,109555,
						107656,99021,72319,72337,72339,72336,72957,96053,99013,97070,151921,148569,145179,124452,143407,144149,
						143266,137312,80394,102294,93156,92734,93481,148581,149409,147463,140063,140066,136047,135218,131722,
						104513,106233,98923,143219,141101,122810,121940,125328,124870,125384,82417,102827,102818,102047,90311,
						88508,88212,88547,89707,99514,94749,119857,97981,98844,110295,109183,108553,147466,127682,113426,107680,
						82852,88221,91074,94411,122208,148393,153115,76411,80913,80137,160642,92065,102853,94992,96984,94766,
						99034,112079,112936,112222,149757,145043,140405,133520,133521,131718,133470,130643,77346,83736,104186,
						121165,72887,155897,155922,155997,153083,153088,152773,149440,148656,127511,123364,127257,138546,100259,
						108233,108547,78103,90916,76463,110253,113448,140285,142458,140224,153906,134571,77762,158947,105395,89745,
						112928,154485,152718,92977,124029,86428,127835,120278,124796,125038,124362,124800,125036,124793,124799,
					    124814,124812,124363,124801,124791,124822,129778,76442,154680,149303,149998,74600,87143,79361,83168,72090,163814,					105476,73031,80906,80907,80901,79777,85317,83558,84469,85316,85381,87817,94497,96729,100463,105475,105474,105478,		101055,105477,104045,103737,109180,118130,107656,109241,109242,112589,117809,115965,113443,115972,114271,114404,118015,
						120663,124782,124783,129192,124544,124539,124543,132600,133512,134631,135380,137127,139526,139628,140940,145659,146326,				146595,146702,147885,148275,148359,148839,149759,150838,135381,151921,163738,165506,166705,169648,168566,168508,168509,
						170201,174936,168399,169621,172563)
					)
				]]></PARAM>
			<PARAM NAME="resource" VALUE="INSP_PROD"/>
			<PARAM NAME="fetch.size" VALUE="0"/>
			<PARAM NAME="result.wrap" VALUE="disconnected"/>			
	</DATA-EXTRACTOR>

	<!-- Data transformer tagged chaged -->

<DATA-TRANSFORMER NAME="trans"  TYPE="scriptlet-mvel" POOL-SIZE="10" THREAD-COUNT="1">
		<PARAM NAME="rejection.report.type" VALUE="file"/>
		<PARAM NAME="rejection.report.source" VALUE="C:/app/temp/pecs/report"/>
		<PARAM NAME="script.input" VALUE="inline"/>
		<PARAM NAME="script.value">
			<![CDATA[ 
				import java.util.ArrayList;
				import java.text.SimpleDateFormat;
		
				seq = dataset.getLookupResult("getseqlkup").getFirstRow().getValue(0);
				glrcset = dataset.getLookupResult("gllkup");
				row1 = glrcset.getRow(0);

				clmrset = dataset.getLookupResult("clmlkup");
				row2 = clmrset.getRow(0);

				Long counterParty = row1.getLong("GLP_CNTR_PARTY_ID");
				dept = row1.getValue("GLP_DEPT_ID");
				ccid = row1.getValue("GLP_CURR_ID");
				entid = row1.getValue("GLP_ENTITY_ID");
				amt = row1.getDouble("GLP_AMOUNT").doubleValue();
				tDate =  new SimpleDateFormat("dd-MMM-yyyy").format(row1.getDate("GLP_TRADE_DATE"));
				nar = row1.getValue("GLP_NARRATIVE");
				clm_id = dataset.driverRow.getValue("GLP_INV_ID");


				clmlast = row2.getDate("CLM_LAST_ACTION_DATE");
				clmmoddate = row2.getDate("CLM_MODIFY_DATETIME");
				clmvrfdate = row2.getDate("CLM_VERIFY_DATETIME");

				if( clmlast != null )
				{
					clmlast =  new SimpleDateFormat("dd-MMM-yyyy").format(clmlast);
				}

				if( clmmoddate != null )
				{
					clmmoddate =  new SimpleDateFormat("dd-MMM-yyyy").format(clmmoddate);
				}

				if( clmvrfdate != null )
				{
					clmvrfdate =  new SimpleDateFormat("dd-MMM-yyyy").format(clmvrfdate);
				}

				postid=row2.getValue("CLM_POST_ID");


				inster1 = "INSERT INTO IN_GLP_GL_POST ( IN_GLP_GL_POST.GLP_ID, IN_GLP_GL_POST.GLP_JRNL_LIN_REF, IN_GLP_GL_POST.GLP_CNTR_PARTY_ID, IN_GLP_GL_POST.GLP_DEPT_ID, IN_GLP_GL_POST.GLP_CURR_ID, IN_GLP_GL_POST.GLP_ACC_AREA, IN_GLP_GL_POST.GLP_ENTITY_ID, IN_GLP_GL_POST.GLP_AMOUNT, IN_GLP_GL_POST.GLP_DR_CR, IN_GLP_GL_POST.GLP_PS_FILE_GEN_DATE, IN_GLP_GL_POST.GLP_VALUE_DATE, IN_GLP_GL_POST.GLP_POST_DATETIME, IN_GLP_GL_POST.GLP_PLA, IN_GLP_GL_POST.GLP_SLA, IN_GLP_GL_POST.GLP_CREATE_BY, IN_GLP_GL_POST.GLP_EVENT, IN_GLP_GL_POST.GLP_CREATE_DATETIME, IN_GLP_GL_POST.GLP_BUSINESS_PROCESS, IN_GLP_GL_POST.GLP_TRADE_DATE, IN_GLP_GL_POST.GLP_NARRATIVE, IN_GLP_GL_POST.GLP_PAY_ID, IN_GLP_GL_POST.GLP_INV_ID, IN_GLP_GL_POST.LAST_UPDATED_DATETIME, IN_GLP_GL_POST.GLP_CREATED_CBD, IN_GLP_GL_POST.GLP_INTELLIMATCH_FILE_GEN_DATE, IN_GLP_GL_POST.GLP_TRADE_ID, IN_GLP_GL_POST.GLP_TRADE_SOURCE, IN_GLP_GL_POST.GLP_AFFILIATE_ENT_ID )
				 VALUES ( SEQ_IN_GL_POSTING.NEXTVAL,"+seq+", "+counterParty+", '"+dept+"', "+ccid+", 'IntReceivable', "+entid+", "+amt+", 'C', NULL, '30-DEC-2008', NULL, '170171', NULL, 'INC1323649', 4016, SYSDATE, 'IC', '"+tDate+"', '"+nar+"', NULL, "+clm_id+", NULL, NULL, NULL, 0, NULL, NULL )";

				inster2 = "INSERT INTO IN_GLP_GL_POST ( IN_GLP_GL_POST.GLP_ID, IN_GLP_GL_POST.GLP_JRNL_LIN_REF, IN_GLP_GL_POST.GLP_CNTR_PARTY_ID, IN_GLP_GL_POST.GLP_DEPT_ID, IN_GLP_GL_POST.GLP_CURR_ID, IN_GLP_GL_POST.GLP_ACC_AREA, IN_GLP_GL_POST.GLP_ENTITY_ID, IN_GLP_GL_POST.GLP_AMOUNT, IN_GLP_GL_POST.GLP_DR_CR, IN_GLP_GL_POST.GLP_PS_FILE_GEN_DATE, IN_GLP_GL_POST.GLP_VALUE_DATE, IN_GLP_GL_POST.GLP_POST_DATETIME, IN_GLP_GL_POST.GLP_PLA, IN_GLP_GL_POST.GLP_SLA, IN_GLP_GL_POST.GLP_CREATE_BY, IN_GLP_GL_POST.GLP_EVENT, IN_GLP_GL_POST.GLP_CREATE_DATETIME, IN_GLP_GL_POST.GLP_BUSINESS_PROCESS, IN_GLP_GL_POST.GLP_TRADE_DATE, IN_GLP_GL_POST.GLP_NARRATIVE, IN_GLP_GL_POST.GLP_PAY_ID, IN_GLP_GL_POST.GLP_INV_ID, IN_GLP_GL_POST.LAST_UPDATED_DATETIME, IN_GLP_GL_POST.GLP_CREATED_CBD, IN_GLP_GL_POST.GLP_INTELLIMATCH_FILE_GEN_DATE, IN_GLP_GL_POST.GLP_TRADE_ID, IN_GLP_GL_POST.GLP_TRADE_SOURCE, IN_GLP_GL_POST.GLP_AFFILIATE_ENT_ID )
				 VALUES ( SEQ_IN_GL_POSTING.NEXTVAL,"+seq+", "+counterParty+", '"+dept+"', "+ccid+", 'PROVISION', "+entid+", "+amt+", 'D', NULL, '30-DEC-2008', NULL, '170176', NULL, 'INC1323649', 4016, SYSDATE, 'IC', '"+tDate+"', '"+nar+"', NULL, "+clm_id+", NULL, NULL, NULL, 0, NULL, NULL )";

				update1 = "UPDATE IC_CLM_CLAIM SET CLM_PRIMARY_STATUS = 'CLOSE',CLM_SECONDARY_STATUS = 'MANC',CLM_MODIFY_BY = 'INC1323649',  CLM_MODIFY_DATETIME = SYSDATE,  CLM_VERIFY_BY = 'SYSTEM',  CLM_VERIFY_DATETIME = SYSDATE,CLM_POST_ID="+seq+",LAST_UPDATED_DATETIME=SYSDATE,CLM_LAST_ACTION_DATE=SYSDATE WHERE CLM_ID="+clm_id;
				

				update2 = "UPDATE IC_CLM_CLAIM SET CLM_PRIMARY_STATUS ='OPEN',CLM_SECONDARY_STATUS = 'PROVISION',CLM_MODIFY_BY = NULL,  CLM_MODIFY_DATETIME = '"+clmmoddate+"',  CLM_VERIFY_BY = NULL, CLM_VERIFY_DATETIME = '"+clmvrfdate+"',CLM_POST_ID="+postid+",LAST_UPDATED_DATETIME=NULL,CLM_LAST_ACTION_DATE="+clmlast+" WHERE CLM_ID="+clm_id;

				dataout.addObject("backout",update2+";\n/");
				dataout.addObject("output",inster1+";\n/\n"+inster2+";\n/\n"+update1+";\n/");
			]]>
		</PARAM>
	</DATA-TRANSFORMER>






	<DATA-WRITERS ON-ERROR="failall" THREAD-COUNT="1">
		<WRITER NAME="filewrite" TYPE="FILE" >
			<PARAM NAME="file.close.event" VALUE="end.app"/>
			<PARAM NAME="file.path" VALUE="H:/sunil"/>
			<PARAM NAME="file.name" VALUE="writeoff.sql"/>
			<PARAM NAME="all.or.none" VALUE="true"/>		
			<PARAM NAME="async.write" VALUE="true"/>		
			<PARAM NAME="file.output" VALUE="single"/>		
			<PARAM NAME="flush.type" VALUE="request"/>
			<PARAM NAME="key.name" VALUE="output"/>
		</WRITER>
		<WRITER NAME="filebackout" TYPE="FILE" >
			<PARAM NAME="file.close.event" VALUE="end.app"/>
			<PARAM NAME="file.path" VALUE="H:/sunil"/>
			<PARAM NAME="file.name" VALUE="backout.sql"/>
			<PARAM NAME="all.or.none" VALUE="true"/>		
			<PARAM NAME="async.write" VALUE="true"/>		
			<PARAM NAME="file.output" VALUE="single"/>		
			<PARAM NAME="flush.type" VALUE="request"/>
			<PARAM NAME="key.name" VALUE="backout"/>
		</WRITER>
	</DATA-WRITERS>
	<RESOURCES>
		<RESOURCE NAME="INSP_PROD" TYPE="DB" LOAD-PRIORITY="2" UNLOAD-PRIORITY="1">
			<PARAM NAME="driver.classname" VALUE="oracle.jdbc.OracleDriver"/>
			<PARAM NAME="connection.url" VALUE="jdbc:oracle:thin:@(description=(address_list= (address=(host=PSGINS41) (protocol=tcp)(port=1522))(address=(host=PSGINS42)(protocol=tcp) (port=1522)) (load_balance=no)(failover=yes))(connect_data=(service_name= PSGINS40.WORLD)))"/>
			<PARAM NAME="user.name" VALUE="vsaji_rodev"/>
			<PARAM NAME="password" VALUE="beijing40"/>
			<PARAM NAME="pool.size" VALUE="10"/>
			<PARAM NAME="pool.on.start" VALUE="false"/>
			<PARAM NAME="max.wait" VALUE="5000"/>
			<PARAM NAME="default.autocommit" VALUE="true"/>
		</RESOURCE>
		<RESOURCE NAME="INSP_DEV" TYPE="DB" LOAD-PRIORITY="2" UNLOAD-PRIORITY="1">
			<PARAM NAME="driver.classname" VALUE="oracle.jdbc.OracleDriver"/>
			<PARAM NAME="connection.url" VALUE="jdbc:oracle:thin:@167.168.137.190:1522:DSGINS41"/>
			<PARAM NAME="user.name" VALUE="inspire_dev"/>
			<PARAM NAME="password" VALUE="inspire_dev"/>
			<PARAM NAME="pool.size" VALUE="10"/>
			<PARAM NAME="pool.on.start" VALUE="false"/>
			<PARAM NAME="max.wait" VALUE="5000"/>
			<PARAM NAME="default.autocommit" VALUE="true"/>
		</RESOURCE>
		<RESOURCE NAME="INSP_UAT" TYPE="DB" LOAD-PRIORITY="2" UNLOAD-PRIORITY="1">
			<PARAM NAME="driver.classname" VALUE="oracle.jdbc.OracleDriver"/>
			<PARAM NAME="connection.url" VALUE="jdbc:oracle:thin:@(description=(address_list= (address=(host=DSGINS51) (protocol=tcp)(port=1522))(address=(host=DSGINS52)(protocol=tcp) (port=1522)) (load_balance=no)(failover=yes))(connect_data=(service_name= DSGINS50.WORLD)))"/>
			<PARAM NAME="user.name" VALUE="inspire_dev"/>
			<PARAM NAME="password" VALUE="inspire_dev"/>
			<PARAM NAME="pool.size" VALUE="10"/>
			<PARAM NAME="pool.on.start" VALUE="false"/>
			<PARAM NAME="max.wait" VALUE="5000"/>
			<PARAM NAME="default.autocommit" VALUE="true"/>
		</RESOURCE>
	</RESOURCES>
	
	<DATA-PROVIDERS>
		<DATA-PROVIDER NAME="getseq" TYPE="DB">
			<PARAM NAME="query"><![CDATA[ select SEQ_IN_GLP_JRNL_LIN_REF.NEXTVAL from dual ]]></PARAM>
			<PARAM NAME="resource" VALUE="INSP_DEV"/>
			<PARAM NAME="fetch.size" VALUE="0"/>
			<PARAM NAME="result.wrap" VALUE="disconnected"/>
		</DATA-PROVIDER>	
		<DATA-PROVIDER NAME="gl" TYPE="DB">
			<PARAM NAME="query"><![CDATA[ select * from INSPIRE.IN_GLP_GL_POST where 
						GLP_BUSINESS_PROCESS='IC' and GLP_JRNL_LIN_REF=${driver$GLP_JRNL_LIN_REF} ]]></PARAM>
			<PARAM NAME="resource" VALUE="INSP_PROD"/>
			<PARAM NAME="fetch.size" VALUE="0"/>
			<PARAM NAME="result.wrap" VALUE="disconnected"/>
		</DATA-PROVIDER>	
		<DATA-PROVIDER NAME="clm" TYPE="DB">
			<PARAM NAME="query"><![CDATA[ select * from INSPIRE.IC_CLM_CLAIM where 
						CLM_ID=${driver$GLP_INV_ID} ]]></PARAM>
			<PARAM NAME="resource" VALUE="INSP_PROD"/>
			<PARAM NAME="fetch.size" VALUE="0"/>
			<PARAM NAME="result.wrap" VALUE="disconnected"/>
		</DATA-PROVIDER>	

	</DATA-PROVIDERS>

	<DATA-LOOKUP>				
		<LOOKUP NAME="getseqlkup" DATA-PROVIDER="getseq"/>
		<LOOKUP NAME="gllkup" DATA-PROVIDER="gl"/>
		<LOOKUP NAME="clmlkup" DATA-PROVIDER="clm"/>
	</DATA-LOOKUP>
	
	<EXCEPTION-HANDLER>
		<HANDLER CLASS="com.cs.sg.spear.core.exception.SpearExceptionHandler" NAME="default.exception.handler"/>
		
		<HANDLE EXCEPTION="com.cs.sg.spear.core.exception.ValidatorException" HANDLER="default.exception.handler">
			<ERROR CODE="ERROR_THRESHOLD_EXCEEDED"  VALUE="*" TYPE="fatal"/>
		</HANDLE>

		<HANDLE EXCEPTION="java.sql.SQL1Exception" HANDLER="default.exception.handler">
			<ERROR CODE="SQL_EXCEPTION"  VALUE="*" TYPE="fatal"/>
		</HANDLE>
		
		<HANDLE EXCEPTION="com.cs.sg.spear.core.exception.SpearRuntimeException" HANDLER="default.exception.handler">
			<ERROR CODE="LOOKUP_NOT_FOUND"  VALUE="*" TYPE="fatal"/>
		</HANDLE>		
	</EXCEPTION-HANDLER>
	
</SPEAR-CONFIG>
