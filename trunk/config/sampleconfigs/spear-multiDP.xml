<?xml version="1.0" encoding="UTF-8"?>
<!--Sample XML file generated by XML Spy v4.4 U (http://www.xmlspy.com)-->
<SPEAR-CONFIG xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="spear.xsd">
	<MODULE>
		<NAME>Spear Demo</NAME>
		<PROCESS-ID>SPEAR</PROCESS-ID>
		<DESCRIPTION>Spear Demo</DESCRIPTION>
		<CYCLE-DEPENDENCIES>
			<ASSERTER CLASS="com.cs.sg.spear.core.cycledependency.SystemGCForcer"/>
			<ASSERTER CLASS="com.cs.sg.spear.core.cycledependency.StatsCollector"/>
		</CYCLE-DEPENDENCIES>
		<MODULE-PARAM>
		   <PARAM NAME="spear.cycle.interval" VALUE="8000"/>
		   <PARAM NAME="spear.shutdown" VALUE="Wed:21:58"/>
		   <PARAM NAME="spear.cycle.count" VALUE="2"/>
		   <PARAM NAME="driver.primary.keys" VALUE="DET_TRADE_REF_NO"/>
		   <PARAM NAME="var.abc" VALUE="@@abc@@"/>	
		</MODULE-PARAM>
	</MODULE>
	<DATA-EXTRACTOR NAME="driver">
			<PARAM NAME="data.provider" VALUE="det-trade,dettrade,dettrade,det-trade,det-trade1"/>
	</DATA-EXTRACTOR>
	<DATA-TRANSFORMER NAME="trans" TYPE="script" POOL-SIZE="10" THREAD-COUNT="1">
		<PARAM NAME="rejection.report.type" VALUE="file"/>
		<PARAM NAME="rejection.report.source" VALUE="C:/app/temp/pecs/report"/>
		<PARAM NAME="script.value"><![CDATA[

			try{
			System.out.println("[DET_TRADE_REF_NO]:["+_dataset.getDriverRow().getValue("det_trade_ref_no")+"]");
			}catch(Exception ex){
					throw ex;
			}

		/**
				try{
					System.out.println("------------------------------------------------");
					System.out.println("[DET_TRADE_REF_NO]:["+_dataset.getDriverRow().getValue("DET_TRADE_REF_NO")+"]");
					System.out.println("[bookLKP]:"+_dataset.getLookupResult("bookLKP").getRowCount());
					System.out.println("[bookLKP]:"+_dataset.getLookupResult("bookLKP").getFirstRow());
					System.out.println("[prodLKP]:"+_dataset.getLookupResult("prodLKP").getRowCount());
					System.out.println("[trdLKP]:"+_dataset.getLookupResult("trdLKP").getRowCount());
					System.out.println("[nCurrency]:"+_dataset.getLookupResult("nCurrency").getRowCount());
					System.out.println("[nCurrency]:"+_dataset.getLookupResult("nCurrency").getFirstRow());
					System.out.println("[bCurrency]:"+_dataset.getLookupResult("bCurrency").getRowCount());
					System.out.println("[bCurrency]:"+_dataset.getLookupResult("nCurrency").getFirstRow());
					System.out.println("[entityLKP]:"+_dataset.getLookupResult("entityLKP").getRowCount());
					System.out.println("------------------------------------------------");
				}catch(Exception ex){
					throw ex;
				}
		**/

		]]></PARAM>
	</DATA-TRANSFORMER>

	<DATA-WRITERS ON-ERROR="ignore" THREAD-COUNT="1">

		<WRITER NAME="result" TYPE="FILE" >
			<PARAM NAME="file.close.event" VALUE="end.app"/>
			<PARAM NAME="file.path" VALUE="c:/app/temp"/>
			<PARAM NAME="file.name" VALUE="trades.txt"/>
			<PARAM NAME="all.or.none" VALUE="true"/>		
			<PARAM NAME="async.write" VALUE="true"/>		
			<PARAM NAME="file.output" VALUE="single"/>		
			<PARAM NAME="backup.on.exist" VALUE="true"/>		
			<PARAM NAME="flush.type" VALUE="request"/>
			<PARAM NAME="header.row"><![CDATA[<roots>]]></PARAM>
			<PARAM NAME="body.row"><![CDATA[ <root>${driver$DET_TRADE_REF_NO},${nCurrency$currency},${bookLKP$bookCD},${trdLKP$TRD_L_NAME}-${trdLKP$TRD_F_NAME},${prodLKP$PRT_PROD_NAME},${entityLKP$ENT_CODE}</root>
			]]></PARAM>
			<PARAM NAME="footer.row"><![CDATA[</roots>]]></PARAM>
		</WRITER>
<WRITER NAME="spearq" TYPE="JMS">
			<PARAM NAME="single.reference" VALUE="false"/>
			<PARAM NAME="key.name" VALUE="trans"/>
			<PARAM NAME="message.1"><![CDATA[<roots>
<root>${driver$DET_TRADE_REF_NO},${nCurrency$currency},${bookLKP$bookCD},${trdLKP$TRD_L_NAME}-${trdLKP$TRD_F_NAME},${prodLKP$PRT_PROD_NAME},${entityLKP$ENT_CODE}</root>
			</roots>]]>
			</PARAM>
			<PARAM NAME="msg.property.1" VALUE="abc=test"/>
			<PARAM NAME="msg.property.2" VALUE="abc1=test1"/>
			<PARAM NAME="destination.name" VALUE="LOCALJMS@spear.test.Queue"/>
		</WRITER>
	</DATA-WRITERS>
	<RESOURCES>
		<RESOURCE NAME="DSGINS40" TYPE="DB" LOAD-PRIORITY="2" UNLOAD-PRIORITY="1">
			<PARAM NAME="driver.classname" VALUE="oracle.jdbc.OracleDriver"/>
			<PARAM NAME="connection.url" VALUE="@@DSGINS40.connectionUrl@@"/>
			<PARAM NAME="user.name" VALUE="@@DSGINS40.userName@@"/>
			<PARAM NAME="password" VALUE="@@DSGINS40.password@@"/>
			<PARAM NAME="pool.size" VALUE="25"/>
			<PARAM NAME="pool.on.start" VALUE="false"/>
			<PARAM NAME="max.wait" VALUE="5000"/>
			<PARAM NAME="default.autocommit" VALUE="true"/>
		</RESOURCE>
		<RESOURCE NAME="PROD" TYPE="DB" LOAD-PRIORITY="2" UNLOAD-PRIORITY="1">
			<PARAM NAME="driver.classname" VALUE="oracle.jdbc.OracleDriver"/>
			<PARAM NAME="connection.url" VALUE="@@PROD.connectionUrl@@"/>
			<PARAM NAME="user.name" VALUE="@@PROD.userName@@"/>
			<PARAM NAME="password" VALUE="@@PROD.password@@"/>
			<PARAM NAME="pool.size" VALUE="25"/>
			<PARAM NAME="pool.on.start" VALUE="false"/>
			<PARAM NAME="max.wait" VALUE="5000"/>
			<PARAM NAME="default.autocommit" VALUE="true"/>
		</RESOURCE>
		<RESOURCE NAME="LOCALJMS" TYPE="JMS" LOAD-PRIORITY="2" UNLOAD-PRIORITY="1">
			<PARAM NAME="jms.type" VALUE="queue"/>
			<PARAM NAME="context" VALUE="LOCAL"/>
			<PARAM NAME="connection.factory" VALUE="inspire.queueconnectionfactory"/>
			<PARAM NAME="session.transacted" VALUE="true"/>
			<PARAM NAME="message.ack.type" VALUE="auto"/>
		</RESOURCE>
		<RESOURCE NAME="LOCAL" TYPE="CONTEXT" LOAD-PRIORITY="1" UNLOAD-PRIORITY="2">
			<PARAM NAME="provider.url" VALUE="t3://localhost:7001"/>
			<PARAM NAME="initialcontext.factoy" VALUE="weblogic.jndi.WLInitialContextFactory"/>
		</RESOURCE>		
		
		</RESOURCES>
	<DATA-PROVIDERS>
		
		<DATA-PROVIDER NAME="thWrap" TYPE="PROC">
			<PARAM NAME="procedure"><![CDATA[
				RecordSet rs=null;
				try{
					rs = _datahandler.getData("trdheader");
				}
				catch(Exception ex){
					System.out.println(ex);
				}
				return rs;
			]]></PARAM>
		</DATA-PROVIDER>
		
		<DATA-PROVIDER NAME="getData" TYPE="PROC">
			<PARAM NAME="procedure"><![CDATA[
			RecordSet rs = null;
				try{
					if(${module@var.abc}==1){
						System.out.println("inside if");
						rs = _datahandler.getData("trans1");
					}
					else{
					System.out.println("inside else");
						RecordSetImpl_Disconnected rs1 = (RecordSetImpl_Disconnected) _datahandler.getData("trans1");
						System.out.println("rs1.count:"+rs1.getRowCount());
						RecordSetImpl_Disconnected rs2 = (RecordSetImpl_Disconnected) _datahandler.getData("trans2");
						System.out.println("rs2.count:"+rs2.getRowCount());
						rs1.addResult(rs2);
						rs= rs1;
					System.out.println("rs.count:"+rs.getRowCount());
					}
				}catch(DataException ex){
					throw ex;
				}
				return rs;
			 ]]></PARAM>
		</DATA-PROVIDER>	

		<DATA-PROVIDER NAME="det-trade" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
				select det_trade_ref_no,det_entity_id,det_product_id,det_book_id,DET_NOTIONAL_CURR_ID,DET_BRO_CURR_ID,DET_POST_ID  from INSPIRE.BR_DET_DERIVATIVE_TRADE where DET_BUSINESS_DATE='17-APR-2009'
			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="fetch.size" VALUE="100"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="det-trade1" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
				select det_trade_ref_no,det_entity_id,det_product_id,det_book_id,DET_NOTIONAL_CURR_ID,DET_BRO_CURR_ID from INSPIRE.BR_DET_DERIVATIVE_TRADE where DET_BUSINESS_DATE=${datacard$BDATE}
			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="fetch.size" VALUE="25"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="dettrade" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
				select * from INSPIRE.BR_DET_DERIVATIVE_TRADE where DET_BUSINESS_DATE=${datacard$BDATE}
			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="fetch.size" VALUE="50"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="entity" TYPE="DB">
			<PARAM NAME="query"><![CDATA[

				select * from INSPIRE.IN_ENT_ENTITY

			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="cache.type" VALUE="begin.app"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="datacard" TYPE="DB">
			<PARAM NAME="query"><![CDATA[

				select to_date('17-APR-2009','DD-MON-YYYY') as bdate from dual

			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="cache.type" VALUE="begin.app"/>
		</DATA-PROVIDER>

		
		<DATA-PROVIDER NAME="book" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
			
				select * from INSPIRE.IN_BK_BOOK where BK_ID=${driver$DET_BOOK_ID}
			
			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="cache.type" VALUE="incremental"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="product" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
			
				select * from INSPIRE.BR_PRT_PRODUCT_TYPE
			
			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="cache.type" VALUE="begin.app"/>
		</DATA-PROVIDER>

		<DATA-PROVIDER NAME="currency" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
			
				select * from INSPIRE.IN_CUR_CURRENCY
			
			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="cache.type" VALUE="begin.app"/>
		</DATA-PROVIDER>


		<DATA-PROVIDER NAME="trader" TYPE="DB">
			<PARAM NAME="query"><![CDATA[
			
				select * from INSPIRE.IN_TRD_TRADER where TRD_ID=${bookLKP$BK_TRADER_ID}
			
			]]></PARAM>
			<PARAM NAME="resource" VALUE="PROD"/>
			<PARAM NAME="cache.type" VALUE="incremental"/>
			<PARAM NAME="cache.flush.event" VALUE="end.cycle"/>
		</DATA-PROVIDER>

	</DATA-PROVIDERS>
	
	<DATA-LOOKUP>				
		
		<LOOKUP NAME="nCurrency" DATA-PROVIDER="currency">
			<FILTER>CUR_ID=${driver$DET_NOTIONAL_CURR_ID}</FILTER>
			<COLUMNS>CONCAT(CUR_CODE,'-',CUR_DESC) as currency</COLUMNS>
		</LOOKUP>

		<LOOKUP NAME="bookLKP" DATA-PROVIDER="book">
			<FILTER>BK_ID=${driver$DET_BOOK_ID}</FILTER>
			<COLUMNS>CONCAT(BK_CODE,'',BK_DESC) as bookCD,BK_TRADER_ID</COLUMNS>
		</LOOKUP>

		<LOOKUP NAME="prodLKP" DATA-PROVIDER="product">
			<FILTER>PRT_ID=${driver$DET_PRODUCT_ID}</FILTER>
			<COLUMNS>PRT_PROD_NAME</COLUMNS>
		</LOOKUP>

		<LOOKUP NAME="trdLKP" DATA-PROVIDER="trader" DEPENDS="bookLKP"/>

		<LOOKUP NAME="entityLKP" DATA-PROVIDER="entity">
			<FILTER>ENT_ID=${driver$DET_ENTITY_ID}</FILTER>
			<COLUMNS>ENT_CODE,ENT_DESC</COLUMNS>
		</LOOKUP>

	</DATA-LOOKUP>

	<EXCEPTION-HANDLER>
		<HANDLER CLASS="com.cs.sg.spear.core.exception.SpearExceptionHandler" NAME="default.exception.handler"/>
		
		<HANDLE EXCEPTION="com.cs.sg.spear.core.exception.ValidatorException" HANDLER="default.exception.handler">
			<ERROR CODE="ERROR_THRESHOLD_EXCEEDED"  VALUE="*" TYPE="fatal"/>
		</HANDLE>

		<HANDLE EXCEPTION="java.sql.SQL1Exception" HANDLER="default.exception.handler">
			<ERROR CODE="SQL_EXCEPTION"  VALUE="*" TYPE="fatal"/>
		</HANDLE>
		
		<HANDLE EXCEPTION="com.cs.sg.spear.core.exception.SpearRuntimeException" HANDLER="default.exception.handler">
			<ERROR CODE="LOOKUP_NOT_FOUND"  VALUE="*" TYPE="fatal"/>
		</HANDLE>		
	</EXCEPTION-HANDLER>
	
</SPEAR-CONFIG>
